<!DOCTYPE html>
<html>
<head>
    <title>Landing Page Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: white;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #1e293b;
        }
        .success { background: #10b981; }
        .error { background: #ef4444; }
        .warning { background: #f59e0b; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #fbbf24;
            color: #0f172a;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #fcd34d;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç FieldForge Landing Page Debugger</h1>
        
        <div id="status"></div>
        
        <div style="margin-top: 20px;">
            <button onclick="checkServer()">Check Server</button>
            <button onclick="checkSupabase()">Check Supabase</button>
            <button onclick="checkSession()">Check Session</button>
            <button onclick="clearSession()">Clear Session</button>
            <button onclick="goToLanding()">Go to Landing</button>
            <button onclick="checkConsole()">Check Console</button>
        </div>
        
        <div id="results" style="margin-top: 20px;"></div>
        
        <iframe id="preview" src="http://localhost:5173" style="width: 100%; height: 600px; border: 2px solid #fbbf24; border-radius: 10px; margin-top: 20px;"></iframe>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.insertBefore(div, results.firstChild);
        }

        async function checkServer() {
            try {
                const response = await fetch('http://localhost:5173');
                if (response.ok) {
                    log('‚úÖ Server is running on port 5173', 'success');
                } else {
                    log(`‚ö†Ô∏è Server responded with status: ${response.status}`, 'warning');
                }
            } catch (error) {
                log(`‚ùå Server not responding: ${error.message}`, 'error');
            }
        }

        async function checkSupabase() {
            try {
                const response = await fetch('https://sxjydbukmknnmncyqsff.supabase.co/auth/v1/health');
                if (response.ok) {
                    log('‚úÖ Supabase connection is healthy', 'success');
                } else {
                    log(`‚ö†Ô∏è Supabase health check failed: ${response.status}`, 'warning');
                }
            } catch (error) {
                log(`‚ùå Cannot connect to Supabase: ${error.message}`, 'error');
            }
        }

        async function checkSession() {
            try {
                // Check localStorage for Supabase session
                const keys = Object.keys(localStorage);
                const supabaseKeys = keys.filter(k => k.includes('supabase'));
                
                if (supabaseKeys.length > 0) {
                    log(`Found ${supabaseKeys.length} Supabase keys in localStorage`, 'warning');
                    supabaseKeys.forEach(key => {
                        const value = localStorage.getItem(key);
                        if (value && value.includes('access_token')) {
                            log('‚ö†Ô∏è Active session found - this will redirect to dashboard', 'warning');
                        }
                    });
                } else {
                    log('‚úÖ No Supabase session found - landing page should display', 'success');
                }
            } catch (error) {
                log(`‚ùå Error checking session: ${error.message}`, 'error');
            }
        }

        async function clearSession() {
            try {
                // Clear all Supabase related items from localStorage
                const keys = Object.keys(localStorage);
                const supabaseKeys = keys.filter(k => k.includes('supabase'));
                
                supabaseKeys.forEach(key => {
                    localStorage.removeItem(key);
                    log(`Removed: ${key}`, 'info');
                });
                
                // Clear cookies
                document.cookie.split(";").forEach((c) => {
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                });
                
                log('‚úÖ Session cleared - refresh the page', 'success');
                
                // Refresh iframe
                document.getElementById('preview').src = document.getElementById('preview').src;
            } catch (error) {
                log(`‚ùå Error clearing session: ${error.message}`, 'error');
            }
        }

        function goToLanding() {
            window.location.href = 'http://localhost:5173';
        }

        function checkConsole() {
            log('Opening developer console - check for errors there', 'info');
            log('Press F12 or Cmd+Option+I to open dev tools', 'info');
        }

        // Auto-check on load
        window.onload = () => {
            checkServer();
            checkSession();
        };
    </script>
</body>
</html>
