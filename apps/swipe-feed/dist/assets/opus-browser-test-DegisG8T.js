class u{gates=[{id:"naming",name:"Brand Naming Consistency",threshold:"0 legacy strings",status:"pending"},{id:"ui-clickable",name:"UI Element Clickability",threshold:"100% interactive elements",status:"pending"},{id:"console-errors",name:"Console Error Check",threshold:"0 console errors",status:"pending"},{id:"viewport",name:"Responsive Design",threshold:"No overlapping elements",status:"pending"},{id:"navigation",name:"Navigation Flow",threshold:"All routes accessible",status:"pending"},{id:"sparks-economy",name:"Sparks Economy",threshold:"Margin 65-75%",status:"pending"},{id:"performance",name:"Performance Metrics",threshold:"Load time <3s",status:"pending"},{id:"accessibility",name:"Accessibility",threshold:"WCAG 2.1 AA",status:"pending"},{id:"storage",name:"Local Storage",threshold:"Data persistence working",status:"pending"},{id:"features",name:"Feature Completeness",threshold:"All features functional",status:"pending"},{id:"security",name:"Security Headers",threshold:"CSP configured",status:"pending"},{id:"mobile",name:"Mobile Compatibility",threshold:"Touch events working",status:"pending"},{id:"ai-assistant",name:"OmniGuide AI",threshold:"Assistant responsive",status:"pending"},{id:"immutable-rules",name:"Design System Compliance",threshold:"All rules enforced",status:"pending"}];consoleErrors=[];originalConsoleError;constructor(){this.originalConsoleError=console.error,console.error=(...e)=>{this.consoleErrors.push(e.join(" ")),this.originalConsoleError(...e)}}async testNaming(){const e=this.findGate("naming");e.status="running";const s=["Story Forge","story-forge","Song Forge","song-forge","Mytha Quest","mytha-quest","Angry Lips","angry-lips","Mytha Tron","mytha-tron"],t=document.body.innerText,a=[];s.forEach(n=>{t.includes(n)&&a.push(`Found legacy pattern: "${n}"`)}),a.length===0?(e.status="passed",e.message="âœ… No legacy naming patterns found"):(e.status="failed",e.errors=a,e.message=`âŒ Found ${a.length} legacy patterns`)}async testClickability(){const e=this.findGate("ui-clickable");e.status="running";const s=document.querySelectorAll('button, a, input, select, textarea, [role="button"], [onclick]');let t=0,a=0;s.forEach(i=>{const o=i,r=o.getBoundingClientRect(),l=window.getComputedStyle(o);r.width>0&&r.height>0&&l.display!=="none"&&l.visibility!=="hidden"&&l.opacity!=="0"?t++:a++});const n=t/(t+a)*100;n===100?(e.status="passed",e.message=`âœ… All ${t} elements are clickable`):(e.status="failed",e.message=`âŒ ${a} elements not clickable (${n.toFixed(1)}% success)`)}async testConsoleErrors(){const e=this.findGate("console-errors");e.status="running",this.consoleErrors.length===0?(e.status="passed",e.message="âœ… No console errors detected"):(e.status="failed",e.errors=this.consoleErrors,e.message=`âŒ ${this.consoleErrors.length} console errors found`)}async testViewport(){const e=this.findGate("viewport");e.status="running";const s=this.checkOverlappingElements();s===0?(e.status="passed",e.message="âœ… No overlapping elements detected"):(e.status="failed",e.message=`âŒ ${s} overlapping elements found`)}async testNavigation(){const e=this.findGate("navigation");e.status="running";const s=document.querySelectorAll('[href], [onclick*="navigate"]');s.length>0?(e.status="passed",e.message=`âœ… ${s.length} navigation elements found`):(e.status="failed",e.message="âŒ No navigation elements found")}async testSparksEconomy(){const e=this.findGate("sparks-economy");e.status="running";const s={free:{users:5e3,revenue:0},creator:{users:3e3,revenue:29.99},guild:{users:1500,revenue:99.99},prime:{users:500,revenue:299.99}};let t=0,a=0;Object.values(s).forEach(o=>{t+=o.users*o.revenue,a+=o.users});const n=a*15,i=(t-n)/t*100;i>=65&&i<=75?(e.status="passed",e.message=`âœ… Margin: ${i.toFixed(1)}% (target: 65-75%)`):(e.status="failed",e.message=`âŒ Margin: ${i.toFixed(1)}% (target: 65-75%)`)}async testPerformance(){const e=this.findGate("performance");e.status="running";const t=window.performance.getEntriesByType("navigation")[0];if(t){const a=t.loadEventEnd-t.fetchStart;a<3e3?(e.status="passed",e.message=`âœ… Load time: ${a.toFixed(0)}ms`):(e.status="failed",e.message=`âŒ Load time: ${a.toFixed(0)}ms (target: <3000ms)`)}else e.status="passed",e.message="âœ… Performance metrics available"}async testAccessibility(){const e=this.findGate("accessibility");e.status="running";const s=[];document.querySelectorAll("img").forEach(o=>{!o.alt&&!o.getAttribute("aria-label")&&s.push("Image without alt text")}),document.querySelectorAll("button").forEach(o=>{!o.textContent?.trim()&&!o.getAttribute("aria-label")&&s.push("Button without label")});const n=document.querySelectorAll("h1, h2, h3, h4, h5, h6");let i=0;n.forEach(o=>{const r=parseInt(o.tagName[1]);r-i>1&&s.push(`Heading hierarchy skip: H${i} to H${r}`),i=r}),s.length===0?(e.status="passed",e.message="âœ… Basic accessibility checks passed"):(e.status="failed",e.errors=s,e.message=`âŒ ${s.length} accessibility issues found`)}async testStorage(){const e=this.findGate("storage");e.status="running";try{const s="opus_test_"+Date.now(),t="test_value";localStorage.setItem(s,t);const a=localStorage.getItem(s);localStorage.removeItem(s),a===t?(e.status="passed",e.message="âœ… LocalStorage working correctly"):(e.status="failed",e.message="âŒ LocalStorage read/write failed")}catch{e.status="failed",e.message="âŒ LocalStorage not available"}}async testFeatures(){const e=this.findGate("features");e.status="running";const s=[{selector:'[class*="AngryLips"], [class*="angry-lips"]',name:"AngryLips"},{selector:'[class*="StoryForge"], [class*="story-forge"]',name:"StoryForge"},{selector:'[class*="SongForge"], [class*="song-forge"]',name:"SongForge"},{selector:'[class*="OmniGuide"], [class*="omniguide"]',name:"OmniGuide"},{selector:'[class*="Sparks"], [class*="sparks"]',name:"Sparks"}],t=[];s.forEach(a=>{document.querySelectorAll(a.selector).length===0&&(document.body.innerText.includes(a.name)||t.push(a.name))}),t.length===0?(e.status="passed",e.message="âœ… All core features detected"):(e.status="failed",e.message=`âŒ Missing features: ${t.join(", ")}`)}async testSecurity(){const e=this.findGate("security");e.status="running";const s=[];document.querySelectorAll("script").forEach(a=>{const n=a.innerHTML;(n.includes("api_key")||n.includes("apiKey")||n.includes("secret")||n.includes("password"))&&s.push("Potential exposed credentials in script")}),window.location.protocol!=="https:"&&window.location.hostname!=="localhost"&&s.push("Not using HTTPS"),s.length===0?(e.status="passed",e.message="âœ… Basic security checks passed"):(e.status="failed",e.errors=s,e.message=`âŒ ${s.length} security concerns`)}async testMobile(){const e=this.findGate("mobile");e.status="running";const s=document.querySelector('meta[name="viewport"]'),t="ontouchstart"in window;s&&s.getAttribute("content")?.includes("width=device-width")?(e.status="passed",e.message=`âœ… Mobile viewport configured${t?", touch events supported":""}`):(e.status="failed",e.message="âŒ Mobile viewport not properly configured")}async testAIAssistant(){const e=this.findGate("ai-assistant");e.status="running",document.querySelector('[class*="omniguide"], [class*="OmniGuide"], [id*="omniguide"]')?(e.status="passed",e.message="âœ… OmniGuide AI Assistant found"):(e.status="failed",e.message="âŒ OmniGuide AI Assistant not found")}async testImmutableRules(){const e=this.findGate("immutable-rules");e.status="running";const s=[],t=document.querySelectorAll('[class*="checkmark"], [class*="check-mark"], .fa-check');t.length>0&&s.push(`Found ${t.length} checkmark elements (forbidden)`);const a=/[\u{1F300}-\u{1F9FF}]/gu;document.querySelectorAll("button, a, h1, h2, h3, h4, h5, h6, nav").forEach(i=>{i.textContent&&a.test(i.textContent)&&s.push("Found emoji in UI element (forbidden)")}),(document.body.innerText.includes("Stream")||document.querySelector('[class*="stream"], [id*="stream"]'))&&s.push("Stream feature detected (should be removed)"),s.length===0?(e.status="passed",e.message="âœ… All immutable rules enforced"):(e.status="failed",e.errors=s,e.message=`âŒ ${s.length} rule violations`)}checkOverlappingElements(){const e=document.querySelectorAll("div, section, header, footer, main, aside");let s=0;const t=[];e.forEach(a=>{const n=a.getBoundingClientRect();n.width>0&&n.height>0&&t.push(n)});for(let a=0;a<t.length;a++)for(let n=a+1;n<t.length;n++){const i=t[a],o=t[n];i.right<o.left||i.left>o.right||i.bottom<o.top||i.top>o.bottom||s++}return s}findGate(e){return this.gates.find(s=>s.id===e)}async runAllTests(){console.log("ğŸš€ OPUS 4.1 - COMPREHENSIVE TEST PROTOCOL"),console.log("=".repeat(60)),await this.testNaming(),await this.testClickability(),await this.testConsoleErrors(),await this.testViewport(),await this.testNavigation(),await this.testSparksEconomy(),await this.testPerformance(),await this.testAccessibility(),await this.testStorage(),await this.testFeatures(),await this.testSecurity(),await this.testMobile(),await this.testAIAssistant(),await this.testImmutableRules();const e=this.gates.filter(o=>o.status==="passed").length,t=this.gates.filter(o=>o.status==="failed").length===0?"passed":"failed",a=this.loadLastReport();let n=0;if(a&&t==="passed"){const o=new Date(a.timestamp),l=(new Date().getTime()-o.getTime())/(1e3*60*60);l>=20&&l<=28?n=(a.consecutiveDaysPassed||0)+1:n=1}else t==="passed"&&(n=1);const i={timestamp:new Date,gates:this.gates,overallStatus:t,consecutiveDaysPassed:n,summary:`${e}/${this.gates.length} gates passed`};return this.saveReport(i),this.printResults(i),console.error=this.originalConsoleError,i}loadLastReport(){try{const e=localStorage.getItem("opus_test_report");return e?JSON.parse(e):null}catch{return null}}saveReport(e){try{localStorage.setItem("opus_test_report",JSON.stringify(e)),localStorage.setItem("opus_test_report_"+Date.now(),JSON.stringify(e))}catch(s){console.error("Failed to save report:",s)}}printResults(e){if(console.log(`
`+"=".repeat(60)),console.log("ğŸ“Š TEST RESULTS"),console.log("=".repeat(60)),this.gates.forEach(s=>{const t=s.status==="passed"?"âœ…":s.status==="failed"?"âŒ":"â¸ï¸";console.log(`${t} ${s.name}`),s.message&&console.log(`   ${s.message}`),s.errors&&s.errors.length>0&&s.errors.forEach(a=>{console.log(`   - ${a}`)})}),console.log(`
`+"-".repeat(60)),console.log(`ğŸ¯ OVERALL: ${e.overallStatus.toUpperCase()}`),console.log(`ğŸ“Š SCORE: ${e.summary}`),console.log(`ğŸ“… CONSECUTIVE DAYS: ${e.consecutiveDaysPassed}/7`),e.consecutiveDaysPassed>=7)console.log(`
ğŸ‰ğŸ‰ğŸ‰ ACCEPTANCE CRITERIA MET! ğŸ‰ğŸ‰ğŸ‰`),console.log("All gates have passed for 7 consecutive days!");else if(e.overallStatus==="passed"){const s=7-e.consecutiveDaysPassed;console.log(`
â³ ${s} more consecutive days needed`)}else console.log(`
âŒ Fix failed tests and run again tomorrow`);console.log("=".repeat(60))}}export{u as OpusBrowserTest,u as default};
